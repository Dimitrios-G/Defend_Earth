<!DOCTYPE html>
<html lang="el">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Earth Defender - D&G Games</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap');
        body { margin: 0; background: #000; color: #0f6; font-family: 'Press Start 2P', cursive; display: flex; justify-content: center; align-items: center; height: 100vh; overflow: hidden; touch-action: none; }
        #frame { width: 950px; height: 850px; border: 4px solid #0f6; position: relative; display: flex; flex-direction: column; background: #000; max-width: 100vw; max-height: 100vh; box-sizing: border-box; }
        .main-title { text-align: center; font-size: 18px; padding: 15px; border-bottom: 2px solid #0f6; }
        header { display: flex; gap: 10px; padding: 10px; font-size: 8px; justify-content: space-around; border-bottom: 2px solid #0f6; flex-wrap: wrap; }
        .stat-item { border: 1px solid #0f6; padding: 5px; border-radius: 5px; min-width: 80px; text-align: center; }
        #uiLives { color: #ff0000; }
        #gamearea { flex: 1; position: relative; overflow: hidden; background: #000; }
        canvas { display: block; width: 100%; height: 100%; cursor: crosshair; }
        footer { display: flex; justify-content: center; gap: 15px; padding: 10px; border-top: 2px solid #0f6; background: #000; width: 100%; box-sizing: border-box; }
        .btn-retro { background: #000; color: #0f6; border: 2px solid #0f6; padding: 8px 12px; font-family: inherit; font-size: 9px; cursor: pointer; }
        .overlay { position: absolute; inset: 0; background: rgba(0,0,0,0.95); display: flex; flex-direction: column; justify-content: center; align-items: center; z-index: 100; text-align: center; padding: 20px; }
        input { background: #000; border: 2px solid #0f6; color: #0f6; padding: 10px; text-align: center; font-family: inherit; margin-bottom: 10px; outline: none; width: 200px; }
        .instructions-box { border: 1px dashed #0f6; padding: 15px; margin-top: 15px; font-size: 7.5px; line-height: 1.8; color: #fff; width: 340px; background: rgba(0, 255, 102, 0.05); }
        .logo-img { width: 180px; margin-bottom: 20px; border: 2px solid #0f6; padding: 5px; background: #111; }
        @media (max-width: 1000px) { #frame { width: 100vw; height: 100vh; border: none; } }
    </style>
</head>
<body>

<div id="frame">
    <div class="main-title">üöÄ EARTH DEFENDER üöÄ</div>
    <header>
        <div class="stat-item">PILOT: <span id="uiName">---</span></div>
        <div class="stat-item">SCORE: <span id="uiScore">0</span></div>
        <div class="stat-item">LVL: <span id="uiLevel">1/40</span></div>
        <div class="stat-item">LIVES: <span id="uiLives">‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è</span></div>
    </header>
    <div id="gamearea">
        <canvas id="gameCanvas" width="950" height="600"></canvas>
        <div id="menu" class="overlay">
            <img src="Designer.png" alt="D&G GAMES" class="logo-img">
            <input type="text" id="nameInput" placeholder="ENTER NAME" maxlength="10">
            <button class="btn-retro" onclick="startGame()">START MISSION</button>
            <div class="instructions-box">
                <span style="color: #0f6;">[ INSTRUCTIONS ]</span><br>
                ‚Ä¢ TOUCH/MOUSE: MOVE & AUTO-FIRE<br>
                ‚Ä¢ KEYS: ARROWS TO MOVE / SPACE TO FIRE<br>
                ‚Ä¢ POW: LEVEL UP YOUR WEAPON<br>
                ‚Ä¢ SHD: ACTIVATE DEFENSE SHIELD<br>
                ‚Ä¢ DRONES: UNLOCKED AT LEVEL 5
            </div>
        </div>
        <div id="gameOver" class="overlay" style="display:none"></div>
    </div>
    <footer>
        <button class="btn-retro" onclick="isPaused = !isPaused">PAUSE</button>
        <button class="btn-retro" onclick="location.reload()">RESTART</button>
    </footer>
</div>

<script>
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');
const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
let isPaused = false, warping = false;
let state = { active: false, score: 0, level: 1, lives: 3, weapon: 0, shield: 0, enemiesRemaining: 0, bossSpawned: false, player: { x: 450, y: 500 }, companionL: { x: 400, y: 500 }, companionR: { x: 500, y: 500 }, companionsActive: false, bullets: [], enemyBullets: [], particles: [], powerups: [], stars: [], keys: {} };

function handleTouch(e) {
    if (!state.active || isPaused || warping) return;
    const rect = canvas.getBoundingClientRect();
    const touch = e.touches ? e.touches[0] : e;
    const scaleX = canvas.width / rect.width;
    const scaleY = canvas.height / rect.height;
    state.player.x = (touch.clientX - rect.left) * scaleX - 20;
    state.player.y = (touch.clientY - rect.top) * scaleY - 22;
    state.keys['Space'] = true;
}
canvas.addEventListener('touchmove', (e) => { e.preventDefault(); handleTouch(e); }, { passive: false });
canvas.addEventListener('touchstart', (e) => { e.preventDefault(); handleTouch(e); }, { passive: false });
canvas.addEventListener('touchend', () => { state.keys['Space'] = false; });
canvas.addEventListener('mousemove', (e) => { if(state.active) handleTouch(e); });
canvas.addEventListener('mousedown', () => { if(state.active) state.keys['Space'] = true; });
canvas.addEventListener('mouseup', () => { state.keys['Space'] = false; });

function playSound(f, t, d, v) { if (audioCtx.state === 'suspended') return; const o = audioCtx.createOscillator(); const g = audioCtx.createGain(); o.type = t; o.frequency.setValueAtTime(f, audioCtx.currentTime); g.gain.exponentialRampToValueAtTime(0.0001, audioCtx.currentTime + d); g.gain.setValueAtTime(v, audioCtx.currentTime); o.connect(g); g.connect(audioCtx.destination); o.start(); o.stop(audioCtx.currentTime + d); }
function startMusic() { let notes = [261, 329, 392, 523, 392, 329]; let i = 0; setInterval(() => { if(state.active && !isPaused) { playSound(notes[i], 'triangle', 0.2, 0.03); i = (i + 1) % notes.length; } }, 200); }

window.onkeydown = e => { state.keys[e.code] = true; if(e.code === 'KeyP') isPaused = !isPaused; };
window.onkeyup = e => state.keys[e.code] = false;

for(let i=0; i<80; i++) state.stars.push({x: Math.random()*950, y: Math.random()*600, s: Math.random()*3+1});

function startGame() { document.getElementById('uiName').innerText = document.getElementById('nameInput').value || "Pilot"; document.getElementById('menu').style.display = 'none'; state.active = true; if (audioCtx.state === 'suspended') audioCtx.resume(); startMusic(); startLevel(); loop(); }
function startLevel() { warping = false; state.bossSpawned = false; state.enemies = []; state.enemyBullets = []; state.powerups = []; state.bullets = []; state.player.y = 500; state.enemiesRemaining = (state.level % 5 === 0) ? 1 : 5 + (state.level * 2); }

function spawnEnemy() {
    let type = 'ufo', hp = 1, ph = Math.random()*6;
    let diffBoost = 1.5 + (state.level * 0.08);
    if(state.level >= 3 && Math.random() < 0.4) { type = 'heavy'; hp = 4; }
    if(state.level >= 9 && Math.random() < 0.2) { type = 'asteroid'; hp = 2; }
    state.enemies.push({ x: Math.random()*850+50, y: -60, s: (1.5+(state.level*0.1)) * diffBoost, hp, mhp: hp, type, boss: false, phase: ph });
}

function update() {
    if(!state.active || isPaused) return;
    if(warping) { state.player.y -= 15; if(state.player.y < -100) { if(state.level >= 40) { endGame(true); return; } state.level++; startLevel(); } return; }

    if(state.keys['ArrowLeft'] && state.player.x > 0) state.player.x -= 7;
    if(state.keys['ArrowRight'] && state.player.x < 910) state.player.x += 7;
    if(state.keys['ArrowUp'] && state.player.y > 0) state.player.y -= 7;
    if(state.keys['ArrowDown'] && state.player.y < 540) state.player.y += 7;
    
    if(state.keys['Space'] && Date.now() - (state.lastF || 0) > 180) { 
        const p = state.player;
        if(state.weapon === 0) state.bullets.push({x: p.x+18, y: p.y, vy: -12});
        else if(state.weapon === 1) { state.bullets.push({x: p.x, y: p.y, vy: -12}); state.bullets.push({x: p.x+36, y: p.y, vy: -12}); }
        else if(state.weapon === 2) { state.bullets.push({x: p.x-10, y: p.y+10, vy: -12}); state.bullets.push({x: p.x+18, y: p.y, vy: -12}); state.bullets.push({x: p.x+46, y: p.y+10, vy: -12}); }
        else if(state.weapon === 3) state.bullets.push({x: p.x+18, y: p.y, vy: -18, laser: true});
        else if(state.weapon === 4) { state.bullets.push({x: p.x, y: p.y, vy: -18, laser: true}); state.bullets.push({x: p.x+36, y: p.y, vy: -18, laser: true}); }
        else { state.bullets.push({x: p.x+15, y: p.y, vy: -15, shell: true}); playSound(150, 'sine', 0.1, 0.05); }
        playSound(600,'square',0.05,0.02); state.lastF = Date.now(); 
    }

    if(state.level >= 5) state.companionsActive = true;
    if(state.companionsActive) {
        state.companionL.x += (state.player.x - 60 - state.companionL.x) * 0.1;
        state.companionL.y += (state.player.y + 20 - state.companionL.y) * 0.1;
        state.companionR.x += (state.player.x + 80 - state.companionR.x) * 0.1;
        state.companionR.y += (state.player.y + 20 - state.companionR.y) * 0.1;
        if(Date.now() - (state.lastCompF || 0) > 600) {
            state.bullets.push({x: state.companionL.x+10, y: state.companionL.y, vy: -10, shell: true});
            state.bullets.push({x: state.companionR.x+10, y: state.companionR.y, vy: -10, shell: true});
            state.lastCompF = Date.now();
        }
    }

    if(state.level % 5 === 0) {
        if(!state.bossSpawned) {
            let bL = state.level / 5;
            state.enemies.push({ x: 350, y: -150, hp: 180 * bL, mhp: 180 * bL, boss: true, d: 1, fireRate: (0.03 + (bL * 0.015)) * 1.5, bLvl: bL });
            state.bossSpawned = true;
        }
    } else if(state.enemiesRemaining > state.enemies.filter(e=>!e.isMinion).length && state.enemies.length < 5) spawnEnemy();

    for(let i = state.enemies.length - 1; i >= 0; i--) {
        let en = state.enemies[i];
        if(en.boss) {
            if(en.y < 60) en.y += 0.8; en.x += (2 + state.level/8) * en.d; if(en.x > 700 || en.x < 0) en.d *= -1;
            if(Math.random() < en.fireRate) { state.enemyBullets.push({x: en.x+45, y: en.y+85, vy: 5.5 + (en.bLvl*0.7)}); state.enemyBullets.push({x: en.x+205, y: en.y+85, vy: 5.5 + (en.bLvl*0.7)}); }
            if(Math.random() < 0.02 * en.bLvl) state.enemies.push({ x: en.x + 125, y: en.y + 80, s: 3.8, hp: 1, type: 'ufo', isMinion: true, phase: Math.random()*6 });
        } else {
            en.y += en.s; if(en.type === 'heavy') en.x = 425 + Math.sin(en.y*0.005 + en.phase)*400; else en.x += Math.sin(en.y*0.05 + en.phase)*2;
            if(en.y > 650) { state.enemies.splice(i, 1); continue; }
            if(Math.abs(en.x - state.player.x) < 40 && Math.abs(en.y - state.player.y) < 40) {
                 if(state.shield > 0) state.shield -= 1; 
                 else { createExplosion(state.player.x + 20, state.player.y + 20, '#f00', 40); state.lives--; state.player.y = 500; playSound(100, 'sawtooth', 0.3, 0.2); }
                 if(state.lives <= 0) endGame(false);
            }
        }
        if(en.hp <= 0) {
            state.score += en.boss ? 2000 : 100;
            if(Math.random() < 0.15) { let t = ['POW', 'SHD', 'LIFE'][Math.floor(Math.random()*3)]; state.powerups.push({x: en.x, y: en.y, t}); }
            createExplosion(en.x+(en.boss?125:25), en.y+25, '#0f6', 20); state.enemies.splice(i, 1); if(!en.isMinion) state.enemiesRemaining--;
        }
    }

    state.bullets = state.bullets.filter(b => {
        b.y += b.vy; state.enemies.forEach(en => { if(b.x > en.x && b.x < en.x+(en.boss?250:50) && b.y < en.y+(en.boss?100:50)) { en.hp -= b.shell ? 4 : (b.laser ? 2 : 1); if(b.shell) createExplosion(b.x, b.y, '#f0f', 5); if(!b.laser) b.y = -100; } });
        return b.y > -50;
    });

    state.enemyBullets = state.enemyBullets.filter(eb => {
        eb.y += 6; let hit = Math.abs(eb.x-(state.player.x+20)) < 30 && Math.abs(eb.y-state.player.y) < 30;
        if(hit) { if(state.shield > 0) state.shield -= 20; else { createExplosion(state.player.x + 20, state.player.y + 20, '#f00', 40); state.lives--; state.player.y = 500; } if(state.lives <= 0) endGame(false); }
        return eb.y < 650 && !hit;
    });

    state.powerups = state.powerups.filter(p => {
        p.y += 3; let hit = Math.abs(p.x - state.player.x) < 50 && Math.abs(p.y - state.player.y) < 50;
        if(hit) { if(p.t === 'POW') state.weapon++; if(p.t === 'SHD') state.shield = 100; if(p.t === 'LIFE') state.lives = Math.min(state.lives + 1, 5); playSound(900, 'sine', 0.2, 0.1); }
        return p.y < 650 && !hit;
    });

    state.particles = state.particles.filter(p => { p.x += p.vx; p.y += p.vy; p.life--; return p.life > 0; });
    if(state.enemiesRemaining <= 0 && state.enemies.length === 0 && !warping) warping = true;
    state.stars.forEach(s => { s.y += warping ? 20 : s.s; if(s.y > 600) s.y = 0; });
    document.getElementById('uiScore').innerText = state.score; document.getElementById('uiLevel').innerText = state.level + "/40"; document.getElementById('uiLives').innerText = "‚ù§Ô∏è".repeat(Math.max(0, state.lives));
}

function drawRocket(x, y, scale, color) {
    ctx.fillStyle = color; ctx.beginPath(); ctx.moveTo(x + (20*scale), y);
    ctx.quadraticCurveTo(x + (40*scale), y + (20*scale), x + (40*scale), y + (45*scale));
    ctx.lineTo(x, y + (45*scale)); ctx.quadraticCurveTo(x, y + (20*scale), x + (20*scale), y); ctx.fill();
}

function draw() {
    ctx.fillStyle = '#000'; ctx.fillRect(0,0,950,600);
    ctx.fillStyle = '#fff'; state.stars.forEach(s => ctx.fillRect(s.x, s.y, 2, 2));
    drawRocket(state.player.x, state.player.y, 1, '#0f6');
    if(state.shield > 0) { ctx.strokeStyle = '#0ff'; ctx.lineWidth = 2; ctx.beginPath(); ctx.arc(state.player.x+20, state.player.y+22, 45, 0, 7); ctx.stroke(); }
    if(state.companionsActive) {
        drawRocket(state.companionL.x, state.companionL.y, 0.5, '#f0f');
        drawRocket(state.companionR.x, state.companionR.y, 0.5, '#f0f');
    }
    state.enemies.forEach(en => {
        if (en.boss) {
            ctx.fillStyle = '#333'; ctx.fillRect(en.x-10, en.y+40, 30, 40); ctx.fillRect(en.x+230, en.y+40, 30, 40);
            ctx.fillStyle = '#555'; ctx.fillRect(en.x+35, en.y+75, 25, 25); ctx.fillRect(en.x+190, en.y+75, 25, 25);
            ctx.fillStyle = '#777'; ctx.beginPath(); ctx.moveTo(en.x, en.y+20); ctx.lineTo(en.x+250, en.y+20); ctx.lineTo(en.x+230, en.y+90); ctx.lineTo(en.x+20, en.y+90); ctx.closePath(); ctx.fill();
            ctx.fillStyle = '#222'; ctx.beginPath(); ctx.arc(en.x+125, en.y+40, 45, 0, Math.PI, true); ctx.fill();
            ctx.fillStyle = (Date.now() % 400 < 200) ? '#f00' : '#400'; ctx.beginPath(); ctx.arc(en.x+80, en.y+45, 8, 0, 7); ctx.arc(en.x+170, en.y+45, 8, 0, 7); ctx.fill();
            ctx.fillStyle = '#333'; ctx.fillRect(en.x, en.y-25, 250, 8); ctx.fillStyle = en.hp < (en.mhp*0.3) ? '#f00' : '#0f6'; ctx.fillRect(en.x, en.y-25, Math.max(0, (en.hp/en.mhp)*250), 8);
        } else {
            if(en.type === 'asteroid') { ctx.fillStyle = '#666'; ctx.beginPath(); ctx.arc(en.x+25, en.y+25, 25, 0, 7); ctx.fill(); }
            else { ctx.fillStyle = en.type === 'heavy' ? '#0f0' : '#f00'; ctx.beginPath(); ctx.ellipse(en.x+25, en.y+25, 30, 12, 0, 0, 7); ctx.fill(); ctx.fillStyle = '#0ff'; ctx.beginPath(); ctx.arc(en.x+25, en.y+20, 12, 0, Math.PI, true); ctx.fill(); }
        }
    });
    state.powerups.forEach(p => { ctx.font = 'bold 10px "Press Start 2P"'; ctx.fillStyle = p.t==='LIFE'?'#f00':(p.t==='POW'?'#f0f':'#0ff'); ctx.fillText(p.t, p.x, p.y+20); });
    state.bullets.forEach(b => { ctx.fillStyle = b.shell ? '#f0f' : (b.laser ? '#0ff' : '#fff'); if(b.shell) { ctx.beginPath(); ctx.arc(b.x, b.y, 8, 0, 7); ctx.fill(); } else ctx.fillRect(b.x, b.y, b.laser?6:4, b.laser?30:10); });
    state.enemyBullets.forEach(eb => { ctx.fillStyle = '#ff0'; ctx.beginPath(); ctx.arc(eb.x, eb.y, 5, 0, 7); ctx.fill(); });
    state.particles.forEach(p => { ctx.fillStyle = p.color; ctx.globalAlpha = p.life/15; ctx.fillRect(p.x, p.y, 2, 2); ctx.globalAlpha = 1; });
}

function createExplosion(x,y,c,n) { for(let i=0; i<n; i++) state.particles.push({x, y, vx:(Math.random()-0.5)*12, vy:(Math.random()-0.5)*12, life:20, color:c}); }
function endGame(win) { state.active = false; let h = `<h1 style="color:${win?'#0f6':'#f00'}">${win?'CONGRATULATIONS!':'GAME OVER'}</h1><button class="btn-retro" onclick="location.reload()">RESTART</button>`; document.getElementById('gameOver').innerHTML = h; document.getElementById('gameOver').style.display = 'flex'; }
function loop() { update(); draw(); if(state.active) requestAnimationFrame(loop); }
</script>
</body>
</html>
